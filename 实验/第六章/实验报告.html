<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>第六章实验报告</title>
  <style>
    body {
      font-family: "PingFang SC", "Heiti SC", sans-serif;
      background: #f4f8ff;
      color: #0b2a55;
      line-height: 1.7;
      padding: 24px;
    }
    .figure-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }
    figure {
      margin: 0;
      background: #f7fbff;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 8px 20px rgba(11, 42, 85, 0.08);
    }
    figure img {
      width: 100%;
      border-radius: 8px;
    }
    figure figcaption {
      margin-top: 8px;
      font-size: 14px;
      color: #335c99;
      text-align: center;
    }
    .report-container {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 20px 45px rgba(11, 42, 85, 0.15);
      overflow: hidden;
    }
    header {
      background: linear-gradient(120deg, #f05a7e, #facf5a);
      color: #fff;
      padding: 32px;
    }
    header h1 {
      margin: 0;
      font-size: 28px;
    }
    section {
      padding: 28px 32px;
      border-bottom: 1px solid #e2ebff;
    }
    section:last-child {
      border-bottom: none;
    }
    h2 {
      color: #c44536;
      margin-top: 0;
    }
    blockquote {
      margin: 16px 0;
      padding: 16px 20px;
      background: #fff2e1;
      border-left: 4px solid #ff8c42;
      border-radius: 8px;
    }
    .code-block {
      background: #1f4ea8;
      color: #e2ebff;
      padding: 16px;
      border-radius: 12px;
      font-family: "JetBrains Mono", Menlo, monospace;
      font-size: 14px;
      overflow-x: auto;
      white-space: pre;
    }
    .info-panel {
      background: #fdf5f2;
      border-radius: 12px;
      padding: 18px;
      margin-top: 16px;
      box-shadow: inset 0 0 0 1px #ffd6c9;
    }
    .info-panel strong {
      color: #c44536;
    }
    footer {
      background: #fff8f0;
      padding: 20px 32px;
      color: #335c99;
    }
    nav {
      background: #ffe7d6;
      padding: 15px 32px;
      border-bottom: 1px solid #ffd6c9;
    }
    nav ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    nav a {
      text-decoration: none;
      color: #c44536;
      font-weight: 500;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .comparison-table {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th,
    td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #ffe7d6;
    }
    .formula {
      text-align: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      margin: 15px 0;
      font-style: italic;
    }
    .wide-figure {
      grid-column: 1 / -1;
    }
  </style>
  <script>
    window.MathJax = {
      tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] },
      svg: { fontCache: "global" },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
</head>
<body>
  <div class="report-container">
    <header>
      <h1>第六章实验报告</h1>
      <p>23336128 梁力航</p>
    </header>

    <nav>
      <ul>
        <li><a href="#background">实验背景</a></li>
        <li><a href="#method1">方法一：HSI 空间均衡</a></li>
        <li><a href="#method2">方法二：RGB 空间均衡</a></li>
        <li><a href="#comparison">综合对比</a></li>
        <li><a href="#conclusion">结论</a></li>
      </ul>
    </nav>

    <section id="background">
      <h2>实验背景</h2>
      <p>
        本章聚焦彩色图像的直方图均衡。教材要求对
        Fig0637(a) 进行两种不同色彩空间下的均衡处理，并对结果进行对比分析。
        实验输入使用 `实验/第六章/图片.tif`，输出位于
        `实验/第六章/输出结果/作业1_HSI与RGB直方图均衡/`。
      </p>
      <blockquote>
        实验目标：<br />
        <strong>方法#1</strong>：转换至 HSI，保持 H、S 不变，仅在 I 通道执行直方图均衡；<br />
        <strong>方法#2</strong>：在 RGB 空间分别对 R、G、B 三个通道执行直方图均衡。
      </blockquote>
    </section>

    <section id="method1">
      <h2>方法一：HSI 空间 I 通道均衡</h2>
      <h3>算法原理</h3>
      <p>
        HSI 模型将色彩信息拆分为色调
        (Hue)、饱和度 (Saturation)、亮度 (Intensity)。
        通过将 RGB 转换到 HSI，只对亮度分量执行直方图均衡，可以改善对比度同时保持色相与饱和度。
      </p>
      <div class="formula">
        \(
        I = \frac{R + G + B}{3}, \quad
        S = 1 - \frac{3}{R+G+B}\min(R,G,B), \quad
        H = \cos^{-1}\frac{(R-G)+(R-B)}{2\sqrt{(R-G)^2 + (R-B)(G-B)}}
        \)
      </div>
      <div class="code-block">
def apply_hsi_equalization(image):
    hsi = rgb_to_hsi(image)             # 范围归一化到 [0,1]
    I_eq = equalize_float_channel(hsi[..., 2])
    hsi[..., 2] = I_eq                  # 仅替换亮度分量
    return hsi_to_rgb(hsi)             # 转回 uint8 RGB
      </div>
      <div class="info-panel">
        <strong>结果观察：</strong>
        亮度均值由 86.0 提升到 130.6，对比度（亮度标准差）增至 73.1，
        平均饱和度从 19.5 增长到 33.2。画面整体通透但色调保持自然，只有高光金属处出现轻微色彩增强。
      </div>
    </section>

    <section id="method2">
      <h2>方法二：RGB 三通道均衡</h2>
      <h3>算法原理</h3>
      <p>
        直接在 RGB 空间分别对三条通道执行直方图均衡。
        每个通道的累积分布函数 (CDF) 被映射到均匀分布，从而提高对应通道的动态范围。
      </p>
      <div class="formula">
        \( s_k = (L-1)\sum_{j=0}^{k}p_r(r_j), \quad r_k \in [0,L-1] \)
      </div>
      <div class="code-block">
def apply_rgb_equalization(image):
    channels = [equalize_uint8(image[..., c]) for c in range(3)]
    return np.stack(channels, axis=-1)
      </div>
      <div class="info-panel">
        <strong>结果观察：</strong>
        亮度均值 128.0，标准差 72.2，略低于 HSI 方法；
        平均饱和度仅增加至 21.7，但由于各通道独立拉伸，
        少数高饱和区域（如红色、绿色灯罩）出现可见色偏。
      </div>
    </section>

    <section id="comparison">
      <h2>可视化与对比</h2>
      <div class="figure-grid">
        <figure>
          <img src="输出结果/作业1_HSI与RGB直方图均衡/原始图像.png" alt="原始图像" />
          <figcaption>原始图像 Fig0637(a)</figcaption>
        </figure>
        <figure>
          <img src="输出结果/作业1_HSI与RGB直方图均衡/方法1_HSI_I通道均衡.png" alt="HSI 均衡" />
          <figcaption>方法#1：HSI I 通道均衡</figcaption>
        </figure>
        <figure>
          <img src="输出结果/作业1_HSI与RGB直方图均衡/方法2_RGB三通道均衡.png" alt="RGB 均衡" />
          <figcaption>方法#2：RGB 三通道均衡</figcaption>
        </figure>
        <figure class="wide-figure">
          <img src="输出结果/作业1_HSI与RGB直方图均衡/完整对比.png" alt="直方图对比" />
          <figcaption>亮度直方图对比</figcaption>
        </figure>
        <figure>
          <img src="输出结果/作业1_HSI与RGB直方图均衡/方法差异可视化.png" alt="差异图" />
          <figcaption>两方法平均通道差异</figcaption>
        </figure>
      </div>

      <div class="comparison-table">
        <table>
          <tr>
            <th>指标</th>
            <th>原始图像</th>
            <th>方法#1：HSI</th>
            <th>方法#2：RGB</th>
          </tr>
          <tr>
            <td>亮度均值</td>
            <td>86.0</td>
            <td>130.6</td>
            <td>128.0</td>
          </tr>
          <tr>
            <td>亮度标准差</td>
            <td>63.4</td>
            <td>73.1</td>
            <td>72.2</td>
          </tr>
          <tr>
            <td>平均饱和度 (相对)</td>
            <td>19.5</td>
            <td>33.2</td>
            <td>21.7</td>
          </tr>
        </table>
      </div>

      <div class="info-panel">
        <strong>差异分析：</strong>
        平均通道绝对差可视化显示，RGB 方法在高亮金属和灯罩区域与 HSI 方法偏差较大，
        主要来自每个通道均衡导致的色调漂移。HSI 方案的差异集中在暗部，说明亮度拉伸更平滑。
      </div>
    </section>

    <section id="conclusion">
      <h2>结论</h2>
      <ul>
        <li>两种方法都显著扩展了亮度动态范围，压缩了原图低灰度聚集。</li>
        <li>HSI 方案在保持色彩真实方面更可靠，适合对色彩还原有要求的场景。</li>
        <li>RGB 方案能在视觉上提供更强的细节对比，但需要接受色偏与饱和度增加。</li>
        <li>在复杂场景中可考虑自适应融合策略：例如仅对 RGB 中的亮度相关组合进行均衡，或对 HSI
          的 S 通道施加轻度拉伸以兼顾色彩与对比度。</li>
      </ul>
    </section>

    <footer>
      <p>
        相关代码与数据：`实验/第六章/代码/作业1_HSI与RGB直方图均衡.py`，`modules/` 子目录，以及
        `输出结果/作业1_HSI与RGB直方图均衡/` 中的图像文件。
      </p>
    </footer>
  </div>
</body>
</html>


